<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Property</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .message { padding: 10px; margin-top: 10px; display: none; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .property-card { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        img { max-width: 100%; height: auto; }
    </style>
</head>
<body>

    <h2>Upload Property</h2>

    <form id="propertyForm">
        <label>Property Name:</label>
        <input type="text" id="propertyName" required><br><br>

        <label>Property Type:</label>
        <input type="text" id="propertyType" required><br><br>

        <label>Description:</label>
        <textarea id="propertyDescription" required></textarea><br><br>

        <label>Price:</label>
        <input type="number" id="price" required><br><br>

        <label>Location:</label>
        <input type="text" id="location" required><br><br>

        <label>Property Image:</label>
        <input type="file" id="propertyImage" accept="image/*" required><br><br>

        <button type="submit">Upload Property</button>
    </form>

    <div id="successMessage" class="message success"></div>
    <div id="errorMessage" class="message error"></div>

    <h2>Property Listings</h2>
    <div id="propertyList"></div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Supabase credentials
            const supabaseUrl = 'https://aetcawszvlpbzxjgvojm.supabase.co';
            const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFldGNhd3N6dmxwYnp4amd2b2ptIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1MTkwMDgsImV4cCI6MjA1NjA5NTAwOH0.BAYjg845TY82BaxwS2pgbvE0cXrGe9HTWToCsw4XtLM';

            // Initialize Supabase
            const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

            // DOM elements
            const propertyForm = document.getElementById('propertyForm');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const propertyList = document.getElementById('propertyList');

            propertyForm.addEventListener('submit', async function(event) {
                event.preventDefault(); // Prevent page refresh

                const propertyName = document.getElementById('propertyName').value.trim();
                const propertyType = document.getElementById('propertyType').value.trim();
                const propertyDescription = document.getElementById('propertyDescription').value.trim();
                const price = parseFloat(document.getElementById('price').value.trim());
                const location = document.getElementById('location').value.trim();
                const propertyImageFile = document.getElementById('propertyImage').files[0];

                if (!propertyName || !propertyType || !propertyDescription || !price || !location || !propertyImageFile) {
                    showError("Please fill in all fields.");
                    return;
                }

                try {
                    const fileName = `${Date.now()}_${propertyImageFile.name}`;
                    const { data: uploadData, error: uploadError } = await supabase
                        .storage
                        .from('milenahomes')
                        .upload(`images/${fileName}`, propertyImageFile, { cacheControl: '3600', upsert: false });

                    if (uploadError) throw uploadError;

                    const { data: publicUrlData } = await supabase
                        .storage
                        .from('milenahomes')
                        .getPublicUrl(`images/${fileName}`);

                    const imageUrl = publicUrlData.publicUrl;

                    const { data: insertData, error: insertError } = await supabase
                        .from('Properties')
                        .insert([
                            {
                                title: propertyName,
                                property_type: propertyType,
                                description: propertyDescription,
                                price: price,
                                location: location,
                                image_url: imageUrl
                            }
                        ]);

                    if (insertError) throw insertError;

                    showSuccess("Property uploaded successfully!");
                    propertyForm.reset();
                    fetchProperties();

                } catch (err) {
                    showError(err.message);
                }
            });

            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            }

            function showError(message) {
                errorMessage.textContent = 'Error: ' + message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }

            async function fetchProperties() {
                propertyList.innerHTML = '';

                try {
                    const { data, error } = await supabase
                        .from('Properties')
                        .select('*')
                        .order('id', { ascending: false });

                    if (error) throw error;

                    if (!data || data.length === 0) {
                        propertyList.innerHTML = '<p>No properties found.</p>';
                        return;
                    }

                    data.forEach((property) => {
                        const propertyCard = document.createElement('div');
                        propertyCard.className = 'property-card';
                        propertyCard.innerHTML = `
                            <h3>${property.title}</h3>
                            <p><strong>Type:</strong> ${property.property_type}</p>
                            <p><strong>Description:</strong> ${property.description}</p>
                            <p><strong>Price:</strong> ${property.price}</p>
                            <p><strong>Location:</strong> ${property.location}</p>
                            <img src="${property.image_url}" alt="${property.title}" />
                        `;
                        propertyList.appendChild(propertyCard);
                    });
                } catch (err) {
                    propertyList.innerHTML = '<p>Error fetching properties.</p>';
                }
            }

            fetchProperties();
        });
    </script>

</body>
</html>














        






















































